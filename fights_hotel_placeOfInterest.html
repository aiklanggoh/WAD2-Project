<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        Hi there, may I know where would you like to go? <input type="text" v-model="place"> 
        <br>
        May I know the country? <input type="text" v-model="country">
        <br>
        <button v-on:click="location()" >Search</button>
        <br>
        <p> {{ name }} </p>
        <p> airports near that area: </p>
        <p v-for="airport in airportArr">{{ airport }} </p>
    </div>

    <script>
        console.log(String(window.location.href))
        this_url = window.location.href
        this_url = this_url.split('key=')
        key = this_url[1]
        console.log(key)
        googleMapKey = 'AIzaSyDJvQ07_z4s7gXHdfECKoynPXsYPvVePAE'
        urlPlace = 'https://maps.googleapis.com/maps/api/place/nearbysearch/json?'
        url = 'https://maps.googleapis.com/maps/api/geocode/json?'
        urlAirport = 'https://test.api.amadeus.com/v1/reference-data/locations/airports'
        urlNearby = 'http://api.geonames.org/findNearbyJSON'
        urlAuth = 'https://test.api.amadeus.com/v1/security/oauth2/token'
        amadeusTour = 'https://test.api.amadeus.com/v1/shopping/activities'
        flightOffer = 'https://test.api.amadeus.com/v2/shopping/flight-offers'
        rainForestApi = 'https://api.rainforestapi.com/request'
        amadeusAccessToken = ''
        axios.post(urlAuth, {
            grant_type: 'client_credentials',
            client_id: 'anWsVbPQ2XRKpVaqhPpAAo6kD3gWg9W4',
            client_secret: 'mVpJAulivwbKwyjE'
        },
        {
            headers: { "Content-Type": "application/x-www-form-urlencoded"}
        }
        )
            .then(response => {
                 console.log(response.data);
                 amadeusAccessToken = response.data.access_token

            })
            .catch( error => {
                console.log(error.message);
            });

        const app = Vue.createApp({ 
            data() { 
                return { 
                    place: '',
                    country: '',
                    name: '',
                    lat: '',
                    log: '',
                    airportArr: []
                };
            }, // data
            methods: {
                location() {
                     axios.get(url,{

                     params: {
                        address: this.place + ' ' + this.country,
                        key: googleMapKey
                     }
                 })
                     .then(response => {
                         this.nearAirport2()
                         console.log(response.data);
                         this.lat = response.data.results[0].geometry.location.lat
                         this.log = response.data.results[0].geometry.location.lng
                         this.nearestAirport()
                         this.name = response.data.results[0].formatted_address
                         this.rainForest()
                         this.flightOffer()
                         this.flightTour()
                         this.nearInterest()
                     })
                     .catch( error => {
                         console.log(error.message);
                     });
                },
                nearestAirport() {

                    axios.get(urlNearby, {
                        params: {
                            lat: this.lat,
                            lng: this.log,
                            fcode: 'AIRP',
                            radius: 300,
                            username: 'wadwad'
                        }
                    })
                        .then(response => {
                             console.log(response.data)
                             airports = response.data.geonames
                             for (let airport in airports) {
                                this.airportArr.push(airports[airport].name)
                             }
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                },
                
                nearInterest() {
                    urlPlace = 'https://maps.googleapis.com/maps/api/place/nearbysearch/json?'
                    axios.get(urlPlace, {
                    headers: {
                        //'Access-Control-Allow-Origin' : '*',
                        "Access-Control-Allow-Headers": "*",
                        },
                        params: {
                            location: '-33.8670522,151.1957362',
                            radius: '1500',
                            type: 'restaurant',
                            key: googleMapKey
                        }
                    })
                        .then(response => {
                             //console.log(response.data);
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                },
                nearAirport2() {
                    axios.get(urlAirport, {
                        headers: {
                        'Authorization' : `Bearer ${amadeusAccessToken}`
                        },
                        params: {
                            latitude:  '22.3129666',
                            longitude: '114.0412819',
                            sort: 'distance'
                        }
                    })
                        .then(response => {
                             //console.log(response.data);
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                },
                flightTour() {
                    axios.get(amadeusTour, {
                        headers: {
                        'Authorization' : `Bearer ${amadeusAccessToken}`
                        },
                        params: {
                            latitude:  this.lat,
                            longitude: this.log,
                            radius: 20
                        }
                    })
                        .then(response => {
                             console.log(response.data);
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                },
                flightOffer() {
                    axios.get(flightOffer, {
                        headers: {
                        'Authorization' : `Bearer ${amadeusAccessToken}`
                        },
                        params: {
                            originLocationCode:  'SYD',
                            destinationLocationCode: 'BKK',
                            departureDate: '2022-12-01',
                            returnDate: '2022-12-11',
                            adults: 1,
                            children: 0,
                            infants: 0,

                        }
                    })
                        .then(response => {
                             console.log(response.data);
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                },
                rainForest() {
                    axios.get(rainForestApi, {
                        params: {
                            api_key: "2FBAD5539D5A4E61AC354F5C56CF5790",
                            search_term: "winter jacket",
                            amazon_domain: 'amazon.com',
                            type: "search"
                        }
                    })
                        .then(response => {
                             console.log(response.data);
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                },
                placeApiGoogleAnotherWay() {
                    const router = require('express').Router()
                    module.exports = router
                    const key = process.env.GOOGLE_API_KEY
                    router.get('/restaurants', async (req, res, next) => {
                    try {
                    const neighborhood = 'chelsea'
                    const borough = 'manhattan'
                    const city = 'new+york+city'
                    const category = 'burgers'
                    const {data} = await axios.get(
   
                    `https://maps.googleapis.com/maps/api/place/textsearch/
                    json?query=${category}+${neighborhood}+${borough}+${city}&
                    type=restaurant&key=${key}`
                    )
                    res.json(data)
                    } 
                    catch (err) {
                    next(err)
                    }
})
                }
                
            } // methods
        });
        const vm = app.mount('#app'); 
    </script>
</body>
</html>