<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        Hi there, may I know where would you like to go? <input type="text" v-model="place"> 
        <br>
        May I know the country? <input type="text" v-model="country">
        <br>
        <button v-on:click="location()" >Search</button>
        <br>
        <p> {{ name }} </p>
        <p> airports near that area: </p>
        <p v-for="airport in airportArr">{{ airport }} </p>
    </div>

    <script>
        googleMapKey = 'AIzaSyDJvQ07_z4s7gXHdfECKoynPXsYPvVePAE'
        urlPlace = 'https://maps.googleapis.com/maps/api/place/nearbysearch/json?'
        url = 'https://maps.googleapis.com/maps/api/geocode/json?'
        urlAirport = 'https://test.api.amadeus.com/v1/reference-data/locations/airports'
        urlNearby = 'http://api.geonames.org/findNearbyJSON'

        const app = Vue.createApp({ 
            data() { 
                return { 
                    place: '',
                    country: '',
                    name: '',
                    lat: '',
                    log: '',
                    airportArr: []
                };
            }, // data
            methods: {
                location() {
                     axios.get(url,{

                     params: {
                        address: this.place + ' ' + this.country,
                        key: googleMapKey
                     }
                 })
                     .then(response => {
                         console.log(response.data);
                         this.lat = response.data.results[0].geometry.location.lat
                         this.log = response.data.results[0].geometry.location.lng
                         this.nearestAirport()
                         this.name = response.data.results[0].formatted_address
                         this.nearInterest()
                     })
                     .catch( error => {
                         console.log(error.message);
                     });
                },
                nearestAirport() {

                    axios.get(urlNearby, {
                        params: {
                            lat: this.lat,
                            lng: this.log,
                            fcode: 'AIRP',
                            radius: 300,
                            username: 'wadwad'
                        }
                    })
                        .then(response => {
                             console.log(response.data)
                             airports = response.data.geonames
                             for (let airport in airports) {
                                this.airportArr.push(airports[airport].name)
                             }
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                },
                
                nearInterest() {
                    urlPlace = 'https://maps.googleapis.com/maps/api/place/nearbysearch/json?'
                    axios.get(urlPlace, {
                    headers: {
                        'Access-Control-Allow-Origin' : '*',
                        "Access-Control-Allow-Headers": "*",
                        },
                        params: {
                            location: '-33.8670522,151.1957362',
                            radius: '1500',
                            type: 'restaurant',
                            key: googleMapKey
                        }
                    })
                        .then(response => {
                             console.log(response.data);
                        })
                        .catch( error => {
                            console.log(error.message);
                        });
                }
                
            } // methods
        });
        const vm = app.mount('#app'); 
    </script>
</body>
</html>